#!/bin/bash

function setWallpaper {
    cp $1 ~/Pictures/Wallpapers/current
    pkill swaybg
    swaybg -i $1 &>/dev/null &
    wal -c
    wal -i $1
    emacsclient -e "(load-theme 'ewal-doom-one t)"
    pkill waybar
    waybar -l off &>/dev/null &

}

if [ -z "$1" ]; then
    echo "Please specify an image file to use."
    exit -1
fi

if [ ! -s "$1" ]; then
    echo "That's not a file.  Try again."
    exit -1
fi

supported=("PNG" "XPM" "JPEG" "TIFF" "PNM" "RAS" "BMP") # gdk-pixbuf

fileType=`file $1 | cut -d " " -f 2`

for imageType in ${supported[@]}
do
    if [ "$fileType" = "$imageType" ]; then
        setWallpaper $1
        exit 0
    fi
done

echo "Not a recognised file type."
exit -1

