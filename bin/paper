#!/bin/bash

# Stop on first error.
set +e

# Default wallpeper.
wallpaper="$HOME/Pictures/Wallpapers/current"
alacrittyConfig="~/.config/alacritty/default-config.toml"

function setWallpaper {
    cp $1 $wallpaper
    pkill hyprpaper
    pkill waybar
    pkill swaync
    wal -a 85 -i ~/Pictures/Wallpapers/current
    cat  ~/.config/alacritty/default-config.toml ~/.cache/wal/colors-alacritty.toml > ~/.config/alacritty/alacritty.toml
    hyprpaper &>/dev/null &
    waybar -l off &>/dev/null &
    swaync &>/dev/null &
    pgrep emacs && emacsclient -e "(load-theme 'ewal-doom-one t)"
}

if [ -z "$1" ]; then
    echo "Please specify an image file to use."
    exit -1
fi

if [ ! -s "$1" ]; then
    echo "That's not a file.  Try again."
    exit -1
fi

supported=("PNG" "XPM" "JPEG" "TIFF" "PNM" "RAS" "BMP") # gdk-pixbuf

fileType=`file $1 | cut -d " " -f 2`

for imageType in ${supported[@]}
do
    if [ "$fileType" = "$imageType" ]; then
        setWallpaper $1
        exit 0
    fi
done

echo "Not a recognised file type."
exit -1

